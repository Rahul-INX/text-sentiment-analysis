<!DOCTYPE html>
<html>
<head>
    <title>Emotion Detection</title>
    <link rel="stylesheet" href="static\styling\style.css">
    <style>
        .result-textarea {
            width: 100%;
            height: 300px;
            resize: vertical;
            overflow-y: auto;
        }

        .result-table {
            width: 100%;
            border-collapse: collapse;
        }

        .result-table th,
        .result-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .low-confidence {
            color: red;
        }

        .medium-confidence {
            color: orange;
        }

        .high-confidence {
            color: green;
        }

        /* Responsive Styles */
        @media (max-width: 768px) {
            .result-textarea {
                height: 200px;
            }

            .result-table th,
            .result-table td {
                padding: 5px;
            }
        }
        
        /* Added CSS */
        .clear-button,
        .submit-button,
        .random-button,
        .set-button {
            color: #fff;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 5px; /* Rounded edges */
            transition: transform 0.3s, box-shadow 0.3s; /* Add transition effect */
        }

        .clear-button {
            background-color: red;
            border-radius: 50%;
            margin-left:10px ;
            padding : 20px;
        }

        .submit-button {
            background-color: #4CAF50;
        }

        .random-button {
            background-color: #2196F3;
        }

        .set-button {
            background-color: #9C27B0;
        }

        .clear-button:focus,
        .submit-button:focus,
        .random-button:focus,
        .set-button:focus {
            outline: none;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.3); /* Add box shadow on focus */
        }

        /* Animate on keypress */
        .clear-button:active,
        .submit-button:active,
        .random-button:active,
        .set-button:active {
            transform: translateY(2px); /* Move button slightly downwards on active state */
        }
        
        .input-container {
            display: flex;
            align-items: center;
        }

    </style>
</head>
<body>
    <h1 style="margin-top: 0px; margin-bottom: 5px;">Emotion Detection</h1>

    <form id="input-form" method="POST" action="/">
        <div class="input-container">
            <textarea name="text" id="input-textarea" style="width: 100%; resize: none;" required placeholder="Enter your text here">{{ random_string }}</textarea>
            <button type="button" class="clear-button" onclick="clearInputTextarea()">Clear</button>
        </div>
        <input type="submit" class="submit-button" value="Submit" style="width: 100%; margin-top: 10px;">
    </form>

    <form method="POST" action="/random">
        <input type="submit" class="random-button" value="Random">
    </form>

    <form id="input-form" method="POST" action="/set_threshold">
        <div style="display: flex; align-items: center;">
            <label for="threshold" style="margin-right: 5px;">Inference Threshold :</label>
            <input type="number" name="threshold" id="threshold" step="0.01" min="0" max="1" value="{{ threshold }}" style="margin-right: 5px;">
            <button type="submit" class="set-button">Set</button>
        </div>
    </form>

    

    {% if inferred_emotions %}
    <h3>Inferred Emotions:</h3>
    <ul>
        {% for emotion in inferred_emotions %}
        <li>{{ emotion }}</li>
        {% endfor %}
    </ul>
    {% endif %}

    <h2 style="margin: 1px;">Result History</h2>
    <div class="result-textarea">
        <table class="result-table">
            <thead>
                <tr>
                    <th>Text</th>
                    <th>Emotion &amp; Probs</th>
                    <th>Inferred Emotions</th>
                    <th>Confidence</th>
                    <th>Timestamp</th>
                </tr>
            </thead>
            <tbody>
                {% for entry in history %}
                <tr>
                    <td>{{ entry['text'] }}</td>
                    <td>
                        {% for i in range(3) %}
                        {% set emotion = entry['emotions'][i] %}
                        {% set probability = entry['probabilities'][i] %}
                        {{ emotion }}: {{ '%.3f' % probability }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        {% for inferred_emotion in entry['inferred_emotions'] %}
                        {{ inferred_emotion }}{% if not loop.last %}, {% endif %}
                        {% endfor %}
                    </td>
                    <td class="{% if entry['probabilities']|max < 0.5 %}low-confidence
                    {% elif entry['probabilities']|max > 0.7 %}high-confidence
                    {% else %}medium-confidence{% endif %}">
                        {% if entry['probabilities']|max < 0.5 %}Low
                        {% elif entry['probabilities']|max > 0.7 %}High
                        {% else %}Medium{% endif %}
                    </td>
                    <td>{{ entry['timestamp'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <form method="POST" action="/clear">
        <input type="submit" value="Clear History">
    </form>

    <footer class="footer">
        <div class="footer-text">
            Developed by: Jathin Rahul Sarath |
            <a href="https://github.com/Rahul-INX/text-sentiment-analysis">GitHub</a>
        </div>
    </footer>

    <script>
        var inputForm = document.getElementById('input-form');
        var inputTextarea = document.getElementById('input-textarea');
        var thresholdInput = document.getElementById('threshold');
        var setButton = document.getElementById('set-button');

        inputForm.addEventListener('submit', function(event) {
            // Check if the textarea value is empty
            if (inputTextarea.value.trim() === '') {
                event.preventDefault(); // Prevent form submission
                return; // Exit the function
            }
        });

        inputTextarea.addEventListener('input', function () {
            this.style.height = 'auto';
            this.style.height = this.scrollHeight + 'px';
        });

        setButton.addEventListener('click', function () {
            var thresholdValue = thresholdInput.value;
            localStorage.setItem('thresholdValue', thresholdValue);
        });

        function clearInputTextarea() {
            inputTextarea.value = '';
        }
    </script>
</body>
</html>
